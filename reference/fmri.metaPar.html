<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linear Mixed-effects Meta-Analysis model for fMRI data — fmri.metaPar • fmri</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linear Mixed-effects Meta-Analysis model for fMRI data — fmri.metaPar" />
<meta property="og:description" content="Group maps are estimated from BOLD effect estimates and their variances previously determined for each subject. The function rma.uni from R package metafor is used to fit mixed-effects meta-analytic models at group level. Voxel-wise regression analysis is accelerated by optional parallel processing using R package parallel." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fmri</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linear Mixed-effects Meta-Analysis model for fMRI data</h1>
    
    <div class="hidden name"><code>fmri.metaPar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Group maps are estimated from BOLD effect estimates and their variances previously determined for each subject. The function <code>rma.uni</code> from R package <span class="pkg">metafor</span> is used to fit mixed-effects meta-analytic models at group level. Voxel-wise regression analysis is accelerated by optional parallel processing using R package <span class="pkg">parallel</span>.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>fmri.metaPar</span><span class='op'>(</span><span class='va'>Cbold</span>, <span class='va'>Vbold</span>, XG <span class='op'>=</span> <span class='cn'>NULL</span>, model <span class='op'>=</span> <span class='cn'>NULL</span>, method <span class='op'>=</span> <span class='st'>"REML"</span>,
             weighted <span class='op'>=</span> <span class='cn'>TRUE</span>, knha <span class='op'>=</span> <span class='cn'>FALSE</span>, mask <span class='op'>=</span> <span class='cn'>NULL</span>, cluster <span class='op'>=</span> <span class='fl'>2</span>,
             wghts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Cbold</th>
      <td><p>a 4D-Array with the aggregated individual BOLD contrast estimates in standard space, e.g. all <code>cbeta</code> maps obtained from single-session analysis with <code><a href='fmri.lm.html'>fmri.lm</a></code> may put together. Dimensions 1 to 3 define the voxel space, dimension 4 indicates a subject. If not the whole brain but a region is analyzed, vectors with region-indices can be preserved by adding as attributes (e.g. <code>attr(Cbold, "xind") &lt;- xind</code>).</p></td>
    </tr>
    <tr>
      <th>Vbold</th>
      <td><p>a 4D-Array with the aggregated variance estimates for the contrast parameters in <code>Cbold</code>, e.g. all <code>var</code> maps obtained from single-session analysis with <code><a href='fmri.lm.html'>fmri.lm</a></code> may put together. Dimensions 1 to 3 define the voxel space, dimension 4 indicates a subject.</p></td>
    </tr>
    <tr>
      <th>XG</th>
      <td><p>optionally, a group-level design matrix of class <code>"data.frame"</code> to include one or more moderators in the model. By default, an intercept is added to the model.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>optionally, a one-sided formula of the form: <code>model &lt;- ~ mod1 + mod2 + mod3</code> describing a model with moderator variables. Adding <code>"-1"</code> removes the intercept term.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>a character string specifying whether a fixed- (method = "FE") or a random/mixed-effects model (method = "REML", default) should be fitted. Further estimators for random/mixed-effects models are available, see documentation of <code>rma.uni</code> function for more details.</p></td>
    </tr>
    <tr>
      <th>weighted</th>
      <td><p>logical indicating whether weighted (<code>weighted = TRUE</code>, default) or unweighted estimation should be used to fit the model.</p></td>
    </tr>
    <tr>
      <th>knha</th>
      <td><p>logical specifying whether the method by Knapp and Hartung (2003) should be used for adjusting standard errors of the estimated coefficients (default is FALSE). The Knapp and Hartung adjustment is only meant to be used in the context of random- or mixed-effects models.</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>if available, a logical 3D-Array of dimensionality of the data (without 4th subject component) describing a brain mask. The computation is restricted to the selected voxels.</p></td>
    </tr>
    <tr>
      <th>cluster</th>
      <td><p>number of threads for parallel processing, which is limited to available multi-core CPUs. If you do not know your CPUs, try: <code>detectCores()</code> from <span class="pkg">parallel</span> package. Presets are 2 threads. <code>cluster = 1</code> does not use <span class="pkg">parallel</span> package.</p></td>
    </tr>
    <tr>
      <th>wghts</th>
      <td><p>a vector of length 3 specifying ratio of voxel dimensions. Isotropic voxels (e.g. MNI-space) are set as default.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><!-- %%  ~~ If necessary, more details than the description above ~~ -->
<code>fmri.metaPar()</code> fits the configured linear mixed-effects meta-analytic (MEMA) model separately at each voxel and extracts the first regression coefficient (usually the overall group mean), corresponding squared standard errors and degrees of freedom as well as the residuals from resulting <code><a href='https://wviechtb.github.io/metafor/reference/rma.uni.html'>rma.uni()</a></code> objects, to obtain a statistical parametric map (SPM) for the group. Voxel-by-voxel analysis is performed by either the function <code><a href='https://rdrr.io/r/base/apply.html'>apply</a></code> or <code>parApply</code> from <span class="pkg">parallel</span> package, which walks through the <code>Cbold</code> array.</p>
<p>This two-stage approach reduces the computational burden of fitting a full linear mixed-effects (LME) model, <code><a href='fmri.lmePar.html'>fmri.lmePar</a></code> would do. It assumes first level design is same across subjects and normally distributed not necessarily homogeneous within-subject errors. Warping to standard space has been done before first-stage analyses are carried out. Either no masking or a uniform brain mask should be applied at individual subject analysis level, to avoid loss of information at group level along the edges.</p>
<p>At the second stage, observed individual BOLD effects from each study are combined in a meta-analytic model. There is the opportunity of weighting the fMRI studies by the precision of their respective effect estimate to take account of first level residual heterogeneity (<code>weighted = TRUE</code>). This is how to deal with intra-subject variability. The REML estimate of cross-subject variability (tau-squared) assumes that each of these observations is drawn independently from the same Gaussian distribution. Since correlation structures cannot be modeled, multi-subject fMRI studies with repeated measures cannot be analyzed in this way.</p>
<p>Spatial correlation among voxels, e.g. through the activation of nearby voxels, is ignored at this stage, but corrects for it, when random field theory define a threshold for significant activation at inference stage.</p>
<p>It is recommended to check your model syntax and residuals choosing some distinct voxels before running the model in loop (see Example). Error handling default is to stop if one of the threads produces an error. When this occurs, the output will be lost from any voxel, where the model has fitted successfully.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"fmrispm"</code> and <code>"fmridata"</code>, basically a list with components:</p>
<dt>beta</dt><dd><p>estimated regression coefficients</p></dd>
  <dt>se</dt><dd><p>estimated standard errors of the coefficients</p></dd>
  <dt>cbeta</dt><dd><p>estimated BOLD contrast parameters for the group. Always the first regression coefficient is taken.</p></dd>
  <dt>var</dt><dd><p>estimated variance of the BOLD contrast parameters</p></dd>
  <dt>mask</dt><dd><p>brain mask</p></dd>
  <dt>res</dt><dd><p>raw (integer size 2) vector containing residuals of the estimated linear mixed-effects meta-analytic model up to scale factor <code>resscale</code></p></dd>
  <dt>resscale</dt><dd><p><code>resscale*extractData(object,"residuals")</code> are the residuals.</p></dd>
  <dt>tau2</dt><dd><p>estimated amount of (residual) heterogeneity. Always 0 when <code>method = "FE"</code>.</p></dd>
  <dt>rxyz</dt><dd><p>array of smoothness from estimated correlation for each voxel in resel space (for analysis without smoothing).</p></dd>
  <dt>scorr</dt><dd><p>array of spatial correlations with maximal lags 5, 5, 3 in x, y and z-direction</p></dd>
  <dt>bw</dt><dd><p>vector of bandwidths (in FWHM) corresponding to the spatial correlation within the data</p></dd>
  <dt>weights</dt><dd><p>ratio of voxel dimensions</p></dd>
  <dt>dim</dt><dd><p>dimension of the data cube and residuals</p></dd>
  <dt>df</dt><dd><p>degrees of freedom for t-statistics, df = (n-p-1)</p></dd>
  <dt>sessions</dt><dd><p>number of observations entering the meta-analytic model, n</p></dd>
  <dt>coef</dt><dd><p>number of coefficients in the meta-analytic model (including the intercept, p+1)</p></dd>
  <dt>method</dt><dd><p>estimator used to fit the meta-analytic model. In case of "FE", it is weighted or unweighted least squares.</p></dd>
  <dt>weighted</dt><dd><p>estimation with inverse-variance weights</p></dd>
  <dt>knha</dt><dd><p>Knapp and Hartung adjustment</p></dd>
  <dt>model</dt><dd><p>meta-analytic regression model</p></dd>
  <dt>cluster</dt><dd><p>number of threads running in parallel</p></dd>
  <dt>attr(*,"design")</dt><dd><p>group-level design matrix</p></dd>
  <dt>attr(*,"approach")</dt><dd><p>two-stage estimation method</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen G., Saad Z.S., Nath A.R., Beauchamp M.S., Cox R.W. (2012). FMRI group analysis combining effect estimates and their variances. NeuroImage, 60: 747-765.</p>
<p>Knapp G. and Hartung J. (2003). Improved tests for a random effects meta-regression with a single covariate. Statistics in Medicine, 22: 2693-2710.</p>
<p>Viechtbauer W. (2005). Bias and efficiency of meta-analytic variance estimators in the random-effects model. Journal of Educational and Behavioral Statistics, 30: 261-293.</p>
<p>Viechtbauer W. (2010). Conducting meta-analyses in R with the metafor package. Journal of Statistical Software, 36(3): 1-48</p>
<p>Viechtbauer W. (2015). <em>metafor: Meta-Analysis Package for R</em> R package version 1.9-7.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Sibylle Dames</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Meta analyses tend to be less powerful for neuroimaging studies, because they only have as many degrees of freedom as number of subjects. If the number of subjects is very small, then it may be impossible to estimate the between-subject variance (tau-squared) with any precision. In this case the fixed effect model may be the only viable option. However, there is also the possibility of using a one-stage model, that includes the full time series data from all subjects and simultaneously estimates subject and group levels parameters (see <code><a href='fmri.lmePar.html'>fmri.lmePar</a></code>). Although this approach is much more computer intensive, it has the advantage of higher degrees of freedom (&gt; 100) at the end.</p>
<ul>
<li><p>experimental designs with a within-subject (repeated measures) factor</p></li>
<li><p>paired samples with varying tasks, unless the contrast of the two conditions is used as input</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://wviechtb.github.io/metafor/reference/rma.uni.html'>rma.uni</a></code>, <code><a href='fmri.lm.html'>fmri.lm</a></code>, <code><a href='fmri.lmePar.html'>fmri.lmePar</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='co'>## Generate some fMRI data sets: noise + stimulus</span></span>
<span class='r-in'><span class='va'>dx</span> <span class='op'>&lt;-</span> <span class='va'>dy</span> <span class='op'>&lt;-</span> <span class='va'>dz</span> <span class='op'>&lt;-</span> <span class='fl'>32</span></span>
<span class='r-in'><span class='va'>dt</span> <span class='op'>&lt;-</span> <span class='fl'>107</span></span>
<span class='r-in'><span class='va'>hrf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.stimulus.html'>fmri.stimulus</a></span><span class='op'>(</span><span class='va'>dt</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>18</span>, <span class='fl'>48</span>, <span class='fl'>78</span><span class='op'>)</span>, <span class='fl'>15</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>stim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>hrf</span>, nrow<span class='op'>=</span> <span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span>, ncol<span class='op'>=</span><span class='va'>dt</span>, byrow<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in matrix(hrf, nrow = dx * dy * dz, ncol = dt, byrow = TRUE)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in array(FALSE, c(dx, dy, dz))</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>mask</span><span class='op'>[</span><span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span>,<span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span>,<span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in mask[12:22, 12:22, 12:22] &lt;- TRUE</span> object 'mask' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>ds1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.0</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.7</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>0.8</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.2</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds1</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds3</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"fmridata"</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in class(ds4) &lt;- "fmridata"</span> object 'ds4' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Stage 1: single-session regression analysis</span></span>
<span class='r-in'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.design.html'>fmri.design</a></span><span class='op'>(</span><span class='va'>hrf</span>, order<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>spm.sub01</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.lm.html'>fmri.lm</a></span><span class='op'>(</span><span class='va'>ds1</span>, <span class='va'>x</span>, <span class='va'>mask</span>, actype <span class='op'>=</span> <span class='st'>"smooth"</span>, verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lm: entering function at 2021-05-15 14:44:26 </span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lm(ds1, x, mask, actype = "smooth", verbose = TRUE)</span> object 'mask' not found</span>
<span class='r-in'><span class='va'>spm.sub02</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.lm.html'>fmri.lm</a></span><span class='op'>(</span><span class='va'>ds2</span>, <span class='va'>x</span>, <span class='va'>mask</span>, actype <span class='op'>=</span> <span class='st'>"smooth"</span>, verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lm: entering function at 2021-05-15 14:44:26 </span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lm(ds2, x, mask, actype = "smooth", verbose = TRUE)</span> object 'mask' not found</span>
<span class='r-in'><span class='va'>spm.sub03</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.lm.html'>fmri.lm</a></span><span class='op'>(</span><span class='va'>ds3</span>, <span class='va'>x</span>, <span class='va'>mask</span>, actype <span class='op'>=</span> <span class='st'>"smooth"</span>, verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lm: entering function at 2021-05-15 14:44:26 </span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lm(ds3, x, mask, actype = "smooth", verbose = TRUE)</span> object 'mask' not found</span>
<span class='r-in'><span class='va'>spm.sub04</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.lm.html'>fmri.lm</a></span><span class='op'>(</span><span class='va'>ds4</span>, <span class='va'>x</span>, <span class='va'>mask</span>, actype <span class='op'>=</span> <span class='st'>"smooth"</span>, verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lm: entering function at 2021-05-15 14:44:26 </span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lm(ds4, x, mask, actype = "smooth", verbose = TRUE)</span> object 'mask' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Store observed individual BOLD effects and their variance estimates</span></span>
<span class='r-in'><span class='va'>subj</span> <span class='op'>&lt;-</span> <span class='fl'>4</span></span>
<span class='r-in'><span class='va'>Cbold</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>subj</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in array(0, dim = c(dx, dy, dz, subj))</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>Cbold</span><span class='op'>[</span>,,,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub01</span><span class='op'>$</span><span class='va'>cbeta</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub01' not found</span>
<span class='r-in'><span class='va'>Cbold</span><span class='op'>[</span>,,,<span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub02</span><span class='op'>$</span><span class='va'>cbeta</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub02' not found</span>
<span class='r-in'><span class='va'>Cbold</span><span class='op'>[</span>,,,<span class='fl'>3</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub03</span><span class='op'>$</span><span class='va'>cbeta</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub03' not found</span>
<span class='r-in'><span class='va'>Cbold</span><span class='op'>[</span>,,,<span class='fl'>4</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub04</span><span class='op'>$</span><span class='va'>cbeta</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub04' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>Vbold</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>subj</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in array(0, dim = c(dx, dy, dz, subj))</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>Vbold</span><span class='op'>[</span>,,,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub01</span><span class='op'>$</span><span class='va'>var</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub01' not found</span>
<span class='r-in'><span class='va'>Vbold</span><span class='op'>[</span>,,,<span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub02</span><span class='op'>$</span><span class='va'>var</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub02' not found</span>
<span class='r-in'><span class='va'>Vbold</span><span class='op'>[</span>,,,<span class='fl'>3</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub03</span><span class='op'>$</span><span class='va'>var</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub03' not found</span>
<span class='r-in'><span class='va'>Vbold</span><span class='op'>[</span>,,,<span class='fl'>4</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>spm.sub04</span><span class='op'>$</span><span class='va'>var</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'spm.sub04' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Stage 2: Random-effects meta-regression analysis</span></span>
<span class='r-in'><span class='co'>## a) Check your model</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.metafor-project.org'>metafor</a></span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Loading required package: Matrix</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Loading 'metafor' package (version 2.4-0). For an overview </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> and introduction to the package please type: help(metafor).</span>
<span class='r-in'><span class='va'>M1.1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wviechtb.github.io/metafor/reference/rma.uni.html'>rma.uni</a></span><span class='op'>(</span><span class='va'>Cbold</span><span class='op'>[</span><span class='fl'>16</span>,<span class='fl'>16</span>,<span class='fl'>16</span>, <span class='op'>]</span>,</span>
<span class='r-in'>                <span class='va'>Vbold</span><span class='op'>[</span><span class='fl'>16</span>,<span class='fl'>16</span>,<span class='fl'>16</span>, <span class='op'>]</span>,</span>
<span class='r-in'>                method <span class='op'>=</span> <span class='st'>"REML"</span>,</span>
<span class='r-in'>                weighted <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>                knha <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>                verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>                control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>stepadj<span class='op'>=</span><span class='fl'>0.5</span>, maxiter<span class='op'>=</span><span class='fl'>2000</span>, threshold<span class='op'>=</span><span class='fl'>0.001</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(mf.yi, data, enclos = sys.frame(sys.parent()))</span> object 'Cbold' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Control list contains convergence parameters later used</span></span>
<span class='r-in'><span class='co'># at whole data cube. Values were adjusted to fMRI data.</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in h(simpleError(msg, call))</span> error in evaluating the argument 'object' in selecting a method for function 'summary': object 'M1.1' not found</span>
<span class='r-in'><span class='fu'><a href='https://wviechtb.github.io/metafor/reference/forest.html'>forest</a></span><span class='op'>(</span><span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in forest(M1.1)</span> object 'M1.1' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/stats/qqnorm.html'>qqnorm</a></span><span class='op'>(</span><span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in qqnorm(M1.1)</span> object 'M1.1' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## b) Estimate a group map</span></span>
<span class='r-in'><span class='co'>## without parallelizing</span></span>
<span class='r-in'><span class='va'>spm.group1a</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.metaPar</span><span class='op'>(</span><span class='va'>Cbold</span>, <span class='va'>Vbold</span>, knha <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>                            mask <span class='op'>=</span> <span class='va'>mask</span>, cluster <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.meta: entering function</span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.metaPar(Cbold, Vbold, knha = TRUE, mask = mask, cluster = 1)</span> object 'Cbold' not found</span>
<span class='r-in'><span class='co'>## same with 4 parallel threads</span></span>
<span class='r-in'><span class='va'>spm.group1b</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.metaPar</span><span class='op'>(</span><span class='va'>Cbold</span>, <span class='va'>Vbold</span>, knha <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>                            mask <span class='op'>=</span> <span class='va'>mask</span>, cluster <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.meta: entering function</span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.metaPar(Cbold, Vbold, knha = TRUE, mask = mask, cluster = 4)</span> object 'Cbold' not found</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Karsten Tabelow, Joerg Polzehl.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


