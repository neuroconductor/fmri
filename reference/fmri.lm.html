<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linear Model for fMRI data — fmri.lm • fmri</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linear Model for fMRI data — fmri.lm" />
<meta property="og:description" content="Estimate the parameters and variances in a linear model." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fmri</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linear Model for fMRI data</h1>
    
    <div class="hidden name"><code>fmri.lm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate the parameters and variances in a linear model.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>fmri.lm</span><span class='op'>(</span><span class='va'>ds</span>, <span class='va'>z</span>, mask <span class='op'>=</span> <span class='cn'>NULL</span>,
          actype <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"smooth"</span>, <span class='st'>"noac"</span>, <span class='st'>"ac"</span>, <span class='st'>"accalc"</span><span class='op'>)</span>,
          contrast <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ds</th>
      <td><p>Data object of class "fmridata"</p></td>
    </tr>
    <tr>
      <th>z</th>
      <td><p>Designmatrix specifying the expected BOLD response(s)
            and additional components for trend and other effects. This can
            either be a matrix (in case that no slice timing is required at
            this stage) or an 3D - array with 3rd dimension correspnding
            to the slice number. It can be interpreted as stacked array of
            of design matrices for the individual slices.</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>Array of dimensionality of the data describing a (brain) mask
               the computation should be restricted to. The default is the
               mask given with the data.</p></td>
    </tr>
    <tr>
      <th>actype</th>
      <td><p>String describing the type of handling autocorrelation
                 of time series. One of "smooth", "nonac", "ac", "accalc".</p></td>
    </tr>
    <tr>
      <th>contrast</th>
      <td><p>Contrast vector for the covariates.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Verbose mode, default is <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function performs parameter estimation in the linear model.
  It implements a two step procedure. After primary estimation of the
  parameters in the first step residuals are obtained. If <code>actype</code>
  <code>%in%</code> <code>c("ac", "accalc", "smooth")</code> an AR(1) model is
  fitted, in each voxel, to the time series of residuals. The estimated
  AR-coefficients are corrected for bias. If <code>actype=="smooth"</code>
  the estimated AR-coefficients are spatially smoothed. If <code>actype</code>
  <code>%in%</code> <code>c("ac", "smooth")</code> the linear model is pre-withened
  using the estimated (and possibly smoothed) AR-coefficients. Parameter
  and variance estimates are then obtained from the pre-withened
  data. The argument <code>keep</code> describes the amount of data which is
  returned. The estimated effects
  $$\tilde{\gamma}_i = C^T\tilde{\beta}_i$$
  and their estimated variances are returned as well as the
  residuals and temporal autocorrelation.
  <code>cbeta</code> then contains the corresponding parameter
  estimates and thus is a vector of corresponding length in each voxel.</p>
<p>If <code>z</code> is an 3-dimensional array the third component is assumed to
  code the design matrix information for the corresponding slice, i.e.
  design matrices to differ with respect to slice timing effects. Note that
  if motion correction needs to be performed in preprocessing slice time
  correction may be better carried out on the data before image registration
  using, e.g., function <code><a href='slicetiming.html'>slicetiming</a></code>.</p>
<p>If warning "Local smoothness characterized by large bandwidth" occurs,
  check <code>scorr</code> elements. If correlation drops with lag towards
  zero, data has been pre-smoothed. Adaptive smoothing the SPM can then
  only be of limited use. If correlation does not go to zero, check the
  residuals of the linear model for unexplained structure (spin saturation
  in first scans? discard them!).</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>object with class attributes "fmrispm" and "fmridata"</p>
<dt>beta</dt><dd><p>estimated parameters</p></dd>
  <dt>cbeta</dt><dd><p>estimated contrast of parameters</p></dd>
  <dt>var</dt><dd><p>estimated variance of the contrast of parameters.</p></dd>
  <dt>varm</dt><dd><p>covariance matrix of the parameters given by <code>vvector</code></p></dd>
  <dt>res</dt><dd><p>raw (integer size 2) vector containing residuals of the estimated linear model
             up to scale factor resscale.</p></dd>
  <dt>resscale</dt><dd><p><code>resscale*extractData(object,"residuals")</code> are the residuals.</p></dd>
  <dt>dim</dt><dd><p>dimension of the data cube and residuals</p></dd>
  <dt>arfactor</dt><dd><p>estimated autocorrelation parameter</p></dd>
  <dt>rxyz</dt><dd><p>array of smoothness from estimated correlation for each
    voxel in resel space (for analysis without smoothing)</p></dd>
  <dt>scorr</dt><dd><p>array of spatial correlations with maximal lags 5, 5, 3 in x,y and z-direction.</p></dd>
  <dt>bw</dt><dd><p>vector of bandwidths (in FWHM) corresponding to the spatial correlation within the data.</p></dd>
  <dt>weights</dt><dd><p>ratio of voxel dimensions</p></dd>
  <dt>vwghts</dt><dd><p>ratio of estimated variances for the stimululi given by
  <code>vvector</code></p></dd>
  <dt>mask</dt><dd><p>head mask.</p></dd>
  <dt>df</dt><dd><p>Degrees of freedom for t-statistics.</p></dd>
  <dt>hrf</dt><dd><p>expected BOLD response for contrast</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Worsley, K.J. (2005). Spatial smoothing of autocorrelations
  to control the degrees of freedom in fMRI analysis. NeuroImage,
  26:635-641.</p>
<p>Worsley, K.J., Liao, C., Aston, J., Petre, V., Duncan,
  G.H., Morales, F., Evans, A.C. (2002). A general statistical analysis
  for fMRI data. NeuroImage, 15:1-15.</p>
<p>Tabelow, K., Polzehl, J., Voss, H.U., and Spokoiny, V. (2006).
<em>Analysing fMRI
    experiments with structure adaptive smoothing procedures</em>,
  NeuroImage, 33:55-62.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Karsten Tabelow <a href='mailto:tabelow@wias-berlin.de'>tabelow@wias-berlin.de</a>,
         Joerg Polzehl <a href='mailto:polzehl@wias-berlin.de'>polzehl@wias-berlin.de</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='fmri.design.html'>fmri.design</a></code>, <code><a href='fmri.stimulus.html'>fmri.stimulus</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='co'># Example 1</span></span>
<span class='r-in'>  <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>32</span><span class='op'>*</span><span class='fl'>32</span><span class='op'>*</span><span class='fl'>32</span><span class='op'>*</span><span class='fl'>107</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>,</span>
<span class='r-in'>               mask<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>32</span>, <span class='fl'>32</span>, <span class='fl'>32</span><span class='op'>)</span><span class='op'>)</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>32</span>, <span class='fl'>32</span>, <span class='fl'>32</span>, <span class='fl'>107</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"fmridata"</span></span>
<span class='r-in'>  <span class='va'>hrf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.stimulus.html'>fmri.stimulus</a></span><span class='op'>(</span><span class='fl'>107</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>18</span>, <span class='fl'>48</span>, <span class='fl'>78</span><span class='op'>)</span>, <span class='fl'>15</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.design.html'>fmri.design</a></span><span class='op'>(</span><span class='va'>hrf</span>,<span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>model</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.lm</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>z</span>, verbose<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>16</span>, <span class='fl'>16</span>, <span class='fl'>16</span>,<span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>16</span>, <span class='fl'>16</span>, <span class='fl'>16</span>, <span class='op'>]</span> <span class='op'>-</span> <span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>"residuals"</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>16</span>, <span class='fl'>16</span>, <span class='fl'>16</span>, <span class='op'>]</span>, col<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Karsten Tabelow, Joerg Polzehl.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


