<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linear Mixed-effects Model for fMRI data — fmri.lmePar • fmri</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linear Mixed-effects Model for fMRI data — fmri.lmePar" />
<meta property="og:description" content="Group maps are directly estimated from the BOLD time series data of all subjects using lme from R package nlme to fit a Linear Mixed-effects Model with temporally correlated and heteroscedastic within-subject errors. Voxel-wise regression analysis is accelerated by optional parallel processing using R package parallel." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fmri</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linear Mixed-effects Model for fMRI data</h1>
    
    <div class="hidden name"><code>fmri.lmePar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Group maps are directly estimated from the BOLD time series data of all subjects using <code>lme</code> from R package <span class="pkg">nlme</span> to fit a Linear Mixed-effects Model with temporally correlated and heteroscedastic within-subject errors. Voxel-wise regression analysis is accelerated by optional parallel processing using R package <span class="pkg">parallel</span>.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>fmri.lmePar</span><span class='op'>(</span><span class='va'>bold</span>, <span class='va'>z</span>, fixed <span class='op'>=</span> <span class='cn'>NULL</span>, random <span class='op'>=</span> <span class='cn'>NULL</span>, mask <span class='op'>=</span> <span class='cn'>NULL</span>,
            ac <span class='op'>=</span> <span class='fl'>0.3</span>, vtype <span class='op'>=</span> <span class='st'>"individual"</span>, cluster <span class='op'>=</span> <span class='fl'>2</span>,
            wghts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>bold</th>
      <td><p>a large 4D-Array with the aggregated fMRI data of all subjects that were previously registered to a common brain atlas. Be careful with the assembly of this array, the order of the data sets has to be compatible with the design matrix: <code>"z"</code>. If not the whole brain but a region is analyzed, vectors with region-indices can be preserved by adding as attributes (e.g. <code>attr(bold, "xind") &lt;- xind</code>).</p></td>
    </tr>
    <tr>
      <th>z</th>
      <td><p>a design matrix for a multi-subject and/or multi-session fMRI-study of class <code>"data.frame"</code> specifying the expected BOLD response(s) and additional components for trend and other effects. Typically a <code><a href='fmri.designG.html'>fmri.designG</a></code> object. This data frame contains all variables named in the model. There are some indispensable variables: <var>"group"</var>, <var>"subj"</var>, <var>"session"</var> and <var>"run"</var>, which define the different strata. That information will be used for setting up the residual variance structure.</p></td>
    </tr>
    <tr>
      <th>fixed</th>
      <td><p>optionally, a one-sided linear formula describing the fixed-effects part of the model. Default settings are:
  <code>fixed &lt;- ~ 0 + hrf + session + drift1:session + drift2:session</code> in case of one detected group, and the same but <code>"hrf"</code> replaced with <code>"hrf:group"</code> if two group levels in <code>z</code> are found. Since an intercept would be a linear combination of the session factor-variable modeling session-specific intercepts, it is excluded.</p></td>
    </tr>
    <tr>
      <th>random</th>
      <td><p>optionally, a one-sided formula of the form <code>~ x1 + ... + xn | g1/.../gm</code>, with <code>~ x1 + ... + xn</code> specifying the model for the random effects and <code>g1/.../gm</code> the grouping structure.<br /></p>
<p>Default is always the basic model without covariates, i.e. <br />
  <code>random &lt;- ~ 0 + hrf|subj</code>  if no repeated measures in <code>z</code> are found (<code>nlevels(z$run)==1</code>),<br />
  <code>random &lt;- ~ 0 + hrf|subj/session</code>  if repeated measures and<br />
  <code>random &lt;- ~ 0 + hrf|session</code>  if repeated measures but one subject only. <br />
  In case of two independent groups:<br />
  <code>random &lt;- list(subj = pdDiag(~ 0 + hrf:group))</code> is used.</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>if available, a logical 3D-Array of dimensionality of the data (without time component) describing a brain mask. The computation is restricted to the selected voxels.</p></td>
    </tr>
    <tr>
      <th>ac</th>
      <td><p>if available, a numeric 3D-Array of dimensionality of the data (without time component) with spatially smoothed autocorrelation parameters should be used in the AR(1) models fitted in each voxel, e.g. locally estimated and smoothed AR(1)-coefficients from <code><a href='fmri.lm.html'>fmri.lm</a></code> applied to the first subject. Alternatively, a global approach with uniform value can be used. In this case enter a number between 0 and 1. Default is <code>0.3</code> applied to all voxels.</p></td>
    </tr>
    <tr>
      <th>vtype</th>
      <td><p>a character string choosing the residual variance model. If <code>"equal"</code>, homoscedastic variance across subjects is assumed setting weights argument in function <code>lme()</code> to zero, whereas <code>"individual"</code> allows different within-subject variances. Default method is <code>"individual"</code> that means subject-specific error variances using formula: <code>weights &lt;- varIdent(form =~ 1|subj)</code>.</p></td>
    </tr>
    <tr>
      <th>cluster</th>
      <td><p>number of threads for parallel processing, which is limited to available multi-core CPUs. If you do not know your CPUs, try: <code>detectCores()</code> from <span class="pkg">parallel</span> package. Presets are 2 threads. <code>cluster = 1</code> does not use <span class="pkg">parallel</span> package.</p></td>
    </tr>
    <tr>
      <th>wghts</th>
      <td><p>a vector of length 3 specifying ratio of voxel dimensions. Isotropic voxels (e.g. MNI-space) are set as default.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><!-- %%  ~~ If necessary, more details than the description above ~~ -->
<code>fmri.lmePar()</code> fits the configured Linear Mixed-effects Model separately at each voxel and extracts estimated BOLD contrasts, corresponding squared standard errors and degrees of freedom as well as the residuals from resulting <code>lme()</code> objects to produce a statistical parametric map (SPM) for the group(s). Voxel-by-voxel analysis is performed by either the function <code><a href='https://rdrr.io/r/base/apply.html'>apply</a></code> or <code>parApply</code> from <span class="pkg">parallel</span> package, which walks through the <code>bold</code> array.</p>
<p>If one group is analyzed, from each fitted model the first fixed-effects coefficient and corresponding parameters are stored in results object. This should be the first specified predictor in the fixed-effects part of the model (verify the attribute of <code>"df"</code> in returned object). However, in two-sample case this principle does not work. The order changes, estimated session-specific intercepts now comes first and the number of these coefficients is not fixed. Therefore in current version it has explicitly been looked for the coefficient names: <var>"hrf:group1"</var> and <var>"hrf:group2"</var>. Available functions within the <span class="pkg">nlme</span> package to extract estimated values from <code>lme()</code> objects do not operate at contrast matrices.</p>
<p>Spatial correlation among voxels, e.g. through the activation of nearby voxels, is ignored at this stage, but corrects for it, when random field theory define a threshold for significant activation at inference stage.</p>
<p>It is recommended to check your model syntax and residuals choosing some distinct voxels before running the model in loop (see Example, step 1); especially for more advanced designs! Error handling default is to stop if one of the threads produces an error. When this occurs, the output will be lost from any voxel, where the model has fitted successfully.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"fmrispm"</code> and <code>"fmridata"</code>, basically a list
with components:</p>
<dt>cbeta, cbeta2</dt><dd><p>estimated BOLD contrast parameters separated for the groups 1 and 2</p></dd>
  <dt>var, var2</dt><dd><p>estimated variance of the contrast parameters separated for the groups 1 and 2</p></dd>
  <dt>mask</dt><dd><p>brain mask</p></dd>
  <dt>res, res2</dt><dd><p>raw (integer size 2) vector containing residuals of the estimated Linear Mixed-effects Model up to scale factor <code>resscale</code> separated for the groups 1 and 2</p></dd>
  <dt>resscale, resscale2</dt><dd><p><code>resscale*extractData(object,"residuals")</code> are the residuals of group 1 and group 2 respectively.</p></dd>
  <dt>arfactor</dt><dd><p>autocorrelation parameters used in AR(1)-model</p></dd>
  <dt>rxyz, rxyz2</dt><dd><p>array of smoothness from estimated correlation for each voxel in resel space separated for the groups 1 and 2 (for analysis without smoothing)</p></dd>
  <dt>scorr, scorr2</dt><dd><p>array of spatial correlations with maximal lags 5, 5, 3 in x, y and z-direction separated for the groups 1 and 2</p></dd>
  <dt>bw, bw2</dt><dd><p>vector of bandwidths (in FWHM) corresponding to the spatial correlation within the data separated for the groups 1 and 2</p></dd>
  <dt>weights</dt><dd><p>ratio of voxel dimensions</p></dd>
  <dt>dim, dim2</dt><dd><p>dimension of the data cube and residuals separated for the groups 1 and 2</p></dd>
  <dt>df, df2</dt><dd><p>degrees of freedom for t-statistics reported in <code>lme()</code> objects for the extracted regression coefficients separated for the groups 1 and 2. The name of the coefficient belonging to this df-value appears as attribute.</p></dd>
  <dt>subjects</dt><dd><p>number of subjects in the study</p></dd>
  <dt>subj.runs</dt><dd><p>number of repeated measures within subjects</p></dd>
  <dt>sessions</dt><dd><p>number of total sessions that were analyzed</p></dd>
  <dt>groups</dt><dd><p>number of groups in the study</p></dd>
  <dt>fixedModel</dt><dd><p>fixed-effects model</p></dd>
  <dt>randomModel</dt><dd><p>random-effects model</p></dd>
  <dt>VarModel</dt><dd><p>assumption about the subject error variances</p></dd>
  <dt>cluster</dt><dd><p>number of threads run in parallel</p></dd>
  <dt>attr(*,"design")</dt><dd><p>design matrix for the multi-subject fMRI-study</p></dd>
  <dt>attr(*,"approach")</dt><dd><p>one-stage estimation method</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Pinheiro J. and Bates D. (2000). Mixed-Effects Models in S and S-Plus. Springer.</p>
<p>Pinheiro J., Bates D., DebRoy S., Sarkar D. and the R Core team (2014). <em>nlme: Linear and Nonlinear Mixed Effects Models</em> R package version 3.1-117.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Sibylle Dames</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Maybe the computing power is insufficient to carry out a whole brain analysis. You have two opportunities: either select and analyze a certain brain area or switch to a two-stage model.</p>
<ul>
<li><p>more than two independent groups</p></li>
<li><p>more than one stimulus (task)</p></li>
<li><p>paired samples with varying tasks</p></li>
<li><p>user defined contrasts</p></li>
</ul>


    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>lme</code>, <code><a href='fmri.designG.html'>fmri.designG</a></code>,
  <code><a href='fmri.design.html'>fmri.design</a></code>, <code><a href='fmri.stimulus.html'>fmri.stimulus</a></code>,
  <code><a href='fmri.metaPar.html'>fmri.metaPar</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='co'>## Generate some fMRI data sets: noise + stimulus</span></span>
<span class='r-in'><span class='va'>dx</span> <span class='op'>&lt;-</span> <span class='va'>dy</span> <span class='op'>&lt;-</span> <span class='va'>dz</span> <span class='op'>&lt;-</span> <span class='fl'>32</span></span>
<span class='r-in'><span class='va'>dt</span> <span class='op'>&lt;-</span> <span class='fl'>107</span></span>
<span class='r-in'><span class='va'>hrf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.stimulus.html'>fmri.stimulus</a></span><span class='op'>(</span><span class='va'>dt</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>18</span>, <span class='fl'>48</span>, <span class='fl'>78</span><span class='op'>)</span>, <span class='fl'>15</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>stim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>hrf</span>, nrow<span class='op'>=</span> <span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span>, ncol<span class='op'>=</span><span class='va'>dt</span>, byrow<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in matrix(hrf, nrow = dx * dy * dz, ncol = dt, byrow = TRUE)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in array(FALSE, c(dx, dy, dz))</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>mask</span><span class='op'>[</span><span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span>,<span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span>,<span class='fl'>12</span><span class='op'>:</span><span class='fl'>22</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in mask[12:22, 12:22, 12:22] &lt;- TRUE</span> object 'mask' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>ds1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.0</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>            <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask<span class='op'>=</span><span class='va'>mask</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.7</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>            <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask<span class='op'>=</span><span class='va'>mask</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>0.8</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>            <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask<span class='op'>=</span><span class='va'>mask</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>ds4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ttt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/readBin.html'>writeBin</a></span><span class='op'>(</span><span class='fl'>1.2</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>dx</span><span class='op'>*</span><span class='va'>dy</span><span class='op'>*</span><span class='va'>dz</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>stim</span><span class='op'>)</span>,</span>
<span class='r-in'>            <span class='fu'><a href='https://rdrr.io/r/base/raw.html'>raw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>, mask<span class='op'>=</span><span class='va'>mask</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>, <span class='va'>dy</span>, <span class='va'>dz</span>, <span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in rnorm(dx * dy * dz * dt)</span> object 'dx' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds1</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds3</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ds4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"fmridata"</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in class(ds4) &lt;- "fmridata"</span> object 'ds4' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Construct a design matrix for a multi-subject study</span></span>
<span class='r-in'><span class='va'>subj</span> <span class='op'>&lt;-</span> <span class='fl'>4</span></span>
<span class='r-in'><span class='va'>runs</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span class='r-in'><span class='va'>z</span> <span class='op'>&lt;-</span><span class='fu'><a href='fmri.designG.html'>fmri.designG</a></span><span class='op'>(</span><span class='va'>hrf</span>, subj <span class='op'>=</span> <span class='va'>subj</span>, runs <span class='op'>=</span> <span class='va'>runs</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Assembly of the aggregated BOLD-Array</span></span>
<span class='r-in'><span class='va'>Bold</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>dx</span>,<span class='va'>dy</span>,<span class='va'>dz</span>,<span class='va'>subj</span><span class='op'>*</span><span class='va'>runs</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in array(0, dim = c(dx, dy, dz, subj * runs * dt))</span> object 'dx' not found</span>
<span class='r-in'><span class='va'>Bold</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>dx</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dy</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dz</span>,<span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>ds1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in extractData(ds1)</span> object 'ds1' not found</span>
<span class='r-in'><span class='va'>Bold</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>dx</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dy</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dz</span>,<span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>1</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>ds2</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in extractData(ds2)</span> object 'ds2' not found</span>
<span class='r-in'><span class='va'>Bold</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>dx</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dy</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dz</span>,<span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>2</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>ds3</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in extractData(ds3)</span> object 'ds3' not found</span>
<span class='r-in'><span class='va'>Bold</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>dx</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dy</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>dz</span>,<span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>3</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>dt</span><span class='op'>*</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extractData.html'>extractData</a></span><span class='op'>(</span><span class='va'>ds4</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in extractData(ds4)</span> object 'ds4' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Step 1: Check the model</span></span>
<span class='r-in'><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>Bold</span><span class='op'>[</span><span class='fl'>16</span>, <span class='fl'>16</span>, <span class='fl'>16</span>, <span class='op'>]</span> <span class='co'># choose one voxel</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in eval(expr, envir, enclos)</span> object 'Bold' not found</span>
<span class='r-in'><span class='va'>M1.1</span> <span class='op'>&lt;-</span>  <span class='fu'>lme</span><span class='op'>(</span>fixed <span class='op'>=</span> <span class='va'>y</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>hrf</span> <span class='op'>+</span> <span class='va'>session</span> <span class='op'>+</span> <span class='va'>drift1</span><span class='op'>:</span><span class='va'>session</span> <span class='op'>+</span> <span class='va'>drift2</span><span class='op'>:</span><span class='va'>session</span>,</span>
<span class='r-in'>            random <span class='op'>=</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>hrf</span><span class='op'>|</span><span class='va'>subj</span>,</span>
<span class='r-in'>            correlation <span class='op'>=</span> <span class='fu'>corAR1</span><span class='op'>(</span>value <span class='op'>=</span> <span class='fl'>0.3</span>, form <span class='op'>=</span> <span class='op'>~</span> <span class='fl'>1</span><span class='op'>|</span><span class='va'>subj</span><span class='op'>/</span><span class='va'>session</span>, fixed<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span class='r-in'>            weights <span class='op'>=</span> <span class='fu'>varIdent</span><span class='op'>(</span>form <span class='op'>=</span><span class='op'>~</span> <span class='fl'>1</span><span class='op'>|</span><span class='va'>subj</span><span class='op'>)</span>,</span>
<span class='r-in'>            method <span class='op'>=</span><span class='st'>"REML"</span>,</span>
<span class='r-in'>            control <span class='op'>=</span> <span class='fu'>lmeControl</span><span class='op'>(</span>rel.tol<span class='op'>=</span><span class='fl'>1e-6</span>, returnObject <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span class='r-in'>            data <span class='op'>=</span> <span class='va'>z</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in lme(fixed = y ~ 0 + hrf + session + drift1:session + drift2:session,     random = ~0 + hrf | subj, correlation = corAR1(value = 0.3,         form = ~1 | subj/session, fixed = TRUE), weights = varIdent(form = ~1 |         subj), method = "REML", control = lmeControl(rel.tol = 1e-06,         returnObject = TRUE), data = z)</span> could not find function "lme"</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in summary(M1.1)</span> object 'M1.1' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Residual plots</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>M1.1</span>, <span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>resid</a></span><span class='op'>(</span><span class='va'>.</span>,type <span class='op'>=</span> <span class='st'>"response"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>scan</span><span class='op'>|</span><span class='va'>subj</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in plot(M1.1, resid(., type = "response") ~ scan | subj)</span> object 'M1.1' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/stats/qqnorm.html'>qqnorm</a></span><span class='op'>(</span><span class='va'>M1.1</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>resid</a></span><span class='op'>(</span><span class='va'>.</span>,type <span class='op'>=</span> <span class='st'>"normalized"</span><span class='op'>)</span><span class='op'>|</span><span class='va'>subj</span>, abline <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in qqnorm(M1.1, ~resid(., type = "normalized") | subj, abline = c(0,     1))</span> object 'M1.1' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Testing the assumption of homoscedasticity</span></span>
<span class='r-in'><span class='va'>M1.2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>M1.1</span>, weights <span class='op'>=</span> <span class='cn'>NULL</span>, data <span class='op'>=</span> <span class='va'>z</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in update(M1.1, weights = NULL, data = z)</span> object 'M1.1' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/stats/anova.html'>anova</a></span><span class='op'>(</span><span class='va'>M1.2</span>, <span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in anova(M1.2, M1.1)</span> object 'M1.2' not found</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Model fit: observed and fitted values</span></span>
<span class='r-in'><span class='va'>fitted.values</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>M1.1</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fitted(M1.1)</span> object 'M1.1' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>dt</span><span class='op'>]</span>, type<span class='op'>=</span><span class='st'>"l"</span>, main <span class='op'>=</span> <span class='st'>"Subject 1"</span>, xlab <span class='op'>=</span> <span class='st'>"scan"</span>,</span>
<span class='r-in'>     ylab <span class='op'>=</span> <span class='st'>"BOLD-signal"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>5</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in plot(y[1:dt], type = "l", main = "Subject 1", xlab = "scan",     ylab = "BOLD-signal", ylim = c(-5, 5))</span> object 'y' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>1</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fitted.values[names(fitted.values) == 1]</span> object of type 'closure' is not subsettable</span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='op'>(</span><span class='va'>dt</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span><span class='op'>]</span>, type<span class='op'>=</span><span class='st'>"l"</span>, main <span class='op'>=</span> <span class='st'>"Subject 2"</span>, xlab <span class='op'>=</span> <span class='st'>"scan"</span>,</span>
<span class='r-in'>     ylab <span class='op'>=</span> <span class='st'>"BOLD-signal"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>5</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in plot(y[(dt + 1):(2 * dt)], type = "l", main = "Subject 2", xlab = "scan",     ylab = "BOLD-signal", ylim = c(-5, 5))</span> object 'y' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>2</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>1</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fitted.values[names(fitted.values) == 2]</span> object of type 'closure' is not subsettable</span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span><span class='op'>]</span>, type<span class='op'>=</span><span class='st'>"l"</span>, main <span class='op'>=</span> <span class='st'>"Subject 3"</span>, xlab <span class='op'>=</span> <span class='st'>"scan"</span>,</span>
<span class='r-in'>     ylab <span class='op'>=</span> <span class='st'>"BOLD-signal"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>5</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in plot(y[(2 * dt + 1):(3 * dt)], type = "l", main = "Subject 3",     xlab = "scan", ylab = "BOLD-signal", ylim = c(-5, 5))</span> object 'y' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>3</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>1</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fitted.values[names(fitted.values) == 3]</span> object of type 'closure' is not subsettable</span>
<span class='r-in'></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='fl'>4</span><span class='op'>*</span><span class='va'>dt</span><span class='op'>)</span><span class='op'>]</span>, type<span class='op'>=</span><span class='st'>"l"</span>, main <span class='op'>=</span> <span class='st'>"Subject 4"</span>, xlab <span class='op'>=</span> <span class='st'>"scan"</span>,</span>
<span class='r-in'>     ylab <span class='op'>=</span> <span class='st'>"BOLD-signal"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>5</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in plot(y[(3 * dt + 1):(4 * dt)], type = "l", main = "Subject 4",     xlab = "scan", ylab = "BOLD-signal", ylim = c(-5, 5))</span> object 'y' not found</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>fitted.values</span><span class='op'>)</span><span class='op'>==</span><span class='fl'>4</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>1</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fitted.values[names(fitted.values) == 4]</span> object of type 'closure' is not subsettable</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Step 2: Estimate a group map</span></span>
<span class='r-in'><span class='co'>## without parallelizing</span></span>
<span class='r-in'><span class='va'>spm.group1a</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.lmePar</span><span class='op'>(</span><span class='va'>Bold</span>, <span class='va'>z</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, cluster <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lme: entering function</span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lmePar(Bold, z, mask = mask, cluster = 1)</span> object 'Bold' not found</span>
<span class='r-in'><span class='co'># same with 4 parallel threads</span></span>
<span class='r-in'><span class='va'>spm.group1b</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.lmePar</span><span class='op'>(</span><span class='va'>Bold</span>, <span class='va'>z</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, cluster <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lme: entering function</span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lmePar(Bold, z, mask = mask, cluster = 4)</span> object 'Bold' not found</span>
<span class='r-in'><span class='co'>## Example for two independent groups</span></span>
<span class='r-in'><span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>z2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fmri.designG.html'>fmri.designG</a></span><span class='op'>(</span><span class='va'>hrf</span>, subj <span class='op'>=</span> <span class='va'>subj</span>, runs <span class='op'>=</span> <span class='va'>runs</span>, group <span class='op'>=</span> <span class='va'>group</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>spm.group2</span> <span class='op'>&lt;-</span> <span class='fu'>fmri.lmePar</span><span class='op'>(</span><span class='va'>Bold</span>, <span class='va'>z2</span>, mask <span class='op'>=</span> <span class='va'>mask</span>, cluster <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> fmri.lme: entering function</span>
<span class='r-err co'><span class='r-pr'>#&gt;</span> <span class='error'>Error in fmri.lmePar(Bold, z2, mask = mask, cluster = 4)</span> object 'Bold' not found</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Karsten Tabelow, Joerg Polzehl.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


